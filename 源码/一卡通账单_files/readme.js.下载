define(function(require, exports, module) {
    var utils = require('utils');
    var bs = require('./readmeBs');
    var winContent;
    var viewConfig = {
        initialize: function(html) {

        	var self = this;
        	
			var mainView = utils.loadCompiledPage('readmePage', require);
			
			html.html(mainView.render(), true);
			
			self.initView();
            
			self.eventMap = {
            		
            	// 编辑在线充值说明
        		'[data-action=editReadme]': self.editExplainAction,
            };
        },
        
        // 初始化页面
        initView: function() {
        	
    		bs.getExplain({type: 'readme'}).done(function(resp) {

                if (resp.code === '0') {
                	
                	if (resp.content !== null) {
                		
                		$("#readme-nodata").hide();
                		$("#readmeForm").append(resp.content);
                		winContent = resp.content;
                		
                	} else {
                		
                		$("#readme-nodata").show();
                		winContent = '';
                		
                	}
                } else {
                	
                	$("#readme-nodata").show();
                	winContent = '';
                	
                }
            });
        },
        // 编辑在线充值说明
        editExplainAction: function() {
        	
        	var self = this;
        	
        	var title = '编辑说明';
        	var content = '<div id="editReadmeForm" style="overflow: hidden"></div>';
        	var size =  {
        		height: 550,
                width: 830
            };   
        	
        	BH_UTILS.bhWindow(content, title, null, size, function(){
        		
        		var content = window.ue.getContent();
        		
        		bs.saveExplain({content:content, type:'readme'}).done(function(resp) {

                    if (resp.code === '0') {
                    	
                    	$.bhTip({ content : resp.msg, state : 'success', hideWaitTime : 1000 });
                    	
                    	$('#readmeForm').empty();
                    	
                        self.initView();
                        
                    } else {
                    	
                    	BH_UTILS.bhDialogDanger({
                    	    title: '提示',
                    	    content: resp.msg,
                    	    buttons:[
                    	             {
                    	                 text:'确定',
                    	                 callback:function(){
                    	                     
                    	                 }
                    	             }
                    	         ]
                    	});
                    }
                });
        	});
        	
        	// 销毁编译器
			if (window.ue) {
				
				window.ue.destroy();
				
			}
			
			// 渲染编译器
			window.ue = bs.renderUeditorContent();
			
			window.ue.ready(function() {
				
				window.ue.setContent(winContent);
				window.ue.setHeight(600);
				
			});
        }
    };
    return viewConfig;
});